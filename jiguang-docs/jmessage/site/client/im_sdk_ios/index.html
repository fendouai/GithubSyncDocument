<!DOCTYPE html>
<!--[if IE 8]>
  <html class="no-js lt-ie9" lang="en">
  <![endif]-->
<!--[if gt IE 8]>
    <!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="JPush Offical"> 
    <title>IM iOS SDK 概述 - 极光文档</title> 
    <link rel="shortcut icon" href="../../favicon.ico">
    <script src="../../js/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../css/highlight.css">
    <script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.js"></script>
    <link href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../client/im_android_api_docs/stylesheet.css" rel="stylesheet">
    <link href="../../client/jmessage_ios_appledoc_html/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
    <script>
    // Current page data
    var mkdocs_page_name = "IM iOS SDK 概述";
    var mkdocs_page_input_path = "client/im_sdk_ios.md";
    var mkdocs_page_url = "/client/im_sdk_ios/";
    </script>
    
    <script src="../../js/jpush.js"></script> 
</head>

<body data-spy="scroll" data-target="#navbar-right">
    <div class="container-fluid">
        <div class="container">
            <div class="row">
                <div class="col-lg-3  col-md-3  col-sm-3">
                    <div id="doc-icon">
                        <a href="http://192.168.10.162/"><img src="/img/icon/logo.png"></a>
                    </div>
                </div>
                <div class="col-lg-7 col-md-8  col-sm-8">
                    <div class="header">
                        <ul class="nav nav-tabs">
                            <li role="presentation">
                                <a href="/jpush/">JPush</a></li>
                            <li role="presentation">
                                <a href="/jmessage/">JMessage</a></li>
                            <li role="presentation">
                                <a href="/jsms/">短信验证码</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2  col-md-1 col-sm-1">
                    <div>
                        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-3  col-md-3 col-sm-4">
                <div id="navbar-left">
                    <ul class="wy-menu">
                        
                        <li class="subnav">
                            
                                <ul class="subnavul">
                                    <li class="subnavli_single">
                                        <span>
                          <a href="../..">JMessage 文档</a></span>
                                    </li>
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    入门指南 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                     <li class="toctree-l1 ">
        <a class="" href="../../guideline/jmessage_guide/">极光IM 指南</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../guideline/jmessage_android_guide/">JMessage Android 集成指南</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../guideline/jmessage_ios_guide/">JMessage iOS 集成指南</a>
    </li>  
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    客户端 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                     <li class="toctree-l1 ">
        <a class="" href="../im_sdk_android/">IM Android SDK 概述</a>
    </li>      <li class="toctree-l1 current">
        <a class="current" href="./">IM iOS SDK 概述</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../im_errorcode/">IM ErrorCode 定义</a>
    </li>  
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    服务器端 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                     <li class="toctree-l1 ">
        <a class="" href="../../server/server_overview/">服务器端 概述</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../server/rest_api_im/">IM REST API</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../server/rest_api_im_report/">IM REST Report</a>
    </li>  
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    高级 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                     <li class="toctree-l1 ">
        <a class="" href="../../advanced/im_message_protocol/">IM 消息协议</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../advanced/im_objects/">IM 对象定义</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../advanced/jmessage_topics/">JMessage高级话题</a>
    </li>  
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    更多 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                     <li class="toctree-l1 ">
        <a class="" href="../../more/use_license/">使用许可协议</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../more/contact_us/">联系我们</a>
    </li>  
                                </ul>
                                <li>
                        <li class="subnav">
                            
                                <ul class="subnavul">
                                    <li class="subnavli_single">
                                        <span>
                          <a href="../../updates/">最近更新</a></span>
                                    </li>
                                </ul>
                                <li>
                        <li class="subnav">
                            
                            <ul class="subnavul">
                                <li class="subnavli">
                                    <span>
                                <a href="#">
                                    资源下载 
                                <div class="nav-icon">
                                    <img src="/img/icon/right.png">
                                </div>                 
                                </a>
                                </span>
                                </li>
                                     <li class="toctree-l1 ">
        <a class="" href="../../resources/">JPush</a>
    </li>      <li class="toctree-l1 ">
        <a class="" href="../../resources_jmessage/">JMessage</a>
    </li>  
                                </ul>
                                <li></ul>
                    </ul>
                </div>
            </div>
            <div class="col-lg-8  col-md-9  col-sm-8">
                <div id="content-top"></div>
                <section>
                    <div class="rst-content"><div id="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">极光文档</a>></li>
    
      
        
          <li><a href="../im_sdk_android/">客户端</a> ></li>
        
      
    
    <li>
    IM iOS SDK 概述
    <!--
    <a href="./">IM iOS SDK 概述</a>
    -->
    </li>
  </ul>
</div>
                        <div role="main">
                            <div class="section"> <h1 id="im-sdk-for-ios">IM SDK for iOS</h1>
<h3 id="summary">Summary 概述</h3>
<p>极光IM（英文名JMessage） SDK 基于 JPush 推送 SDK 开发，提供了 Push SDK 的完整功能，并提供 IM 即时通讯功能。</p>
<p>App 集成了 IM SDK 就不应再集成 JPush SDK（只提供 Push 功能的 SDK）。</p>
<p>要了解极光IM 整体的信息，请参考文档：<a href="../../../guideline/jmessage_guide">极光IM指南</a>。要集成 iOS SDK 请参考文档：<a href="../../../guideline/jmessage_ios_guide">JMessage iOS 集成指南</a>。</p>
<h3 id="functions">Functions 功能</h3>
<p>极光IM 最核心的功能是 IM 即时消息的功能。</p>
<ul>
<li>单聊，群聊；</li>
<li>消息类型：文本、语音、图片；</li>
<li>用户未在线时保存离线消息；</li>
<li>保证消息及时下发；</li>
<li>基于 JPush 原有的大容量稳定的长连接、大容量消息并发能力；</li>
</ul>
<h3 id="api">API 接口</h3>
<p>需要了解完整的 SDK API，有三种方式：</p>
<ul>
<li>直接查看 JMessage.framework 里的 Headers 文件。这些头文件定义了 SDK 提供的对外接口，带有完善的注释与说明，甚至样例代码。</li>
<li>下载 docset 文档。我们使用 Appledoc 工具基于上述 Headers 文件生成了 docset。可以使用 Xcode 直接打开查看，或者使用 Dash 查看。我们建议使用 Dash 效果更好。</li>
<li>使用 Appledoc 生成的文档的在线版本：<a href="../jmessage_ios_appledoc_html/">JMessage iOS SDK APIs</a></li>
</ul>
<p>以下简要地列举 SDK API 提供的功能，同时简要地描述 API 的设计思路、使用场景。</p>
<h4 id="_1">设计思路</h4>
<ul>
<li>能用同步返回的，尽可能同步返回，不用异步接口；</li>
<li>尽可能减少 App 的工作量。例如：媒体文件的路径维护、下载更新等；</li>
</ul>
<h4 id="_2">初始化</h4>
<p>JMessage.h 里定义的 setupJMessage 方法，需要在应用初始化时调用。建议在 AppDelegate 里应用加载完成时调用。</p>
<pre><code>+ (void)setupJMessage:appKey:channel:apsForProduction:category:
</code></pre>

<p>这个调用是必须的。否则 SDK 将不能正常工作。</p>
<h4 id="_3">通知监听</h4>
<p>JMessage SDK 采用 Delegate 的机制给 App 发通知，而不是采用 iOS 平台通用的通知方式。Delegate 的方式更加直接、易用。</p>
<p>可以在 App 的任何类里，调用以下方法来监听事件通知。</p>
<pre><code>[JMessage addDelegate:self withConversation:nil]
</code></pre>
<p>为了上述这行有效，则需要在当前类的头文件里声明实现 JMessageDelegate 协议。以下示例在 AppDelegate 里加监听。</p>
<pre><code>@interface AppDelegate : UIResponder &lt;UIApplicationDelegate,JMessageDelegate&gt;
</code></pre>
<p>监听通知上述 2 个动作外，另外一个动作就是实现你需要监听的事件的方法。比如监听数据库升级：</p>
<pre><code>- (void)onDBMigrateStart {
  NSLog(@"onDBmigrateStart in appdelegate");
  _isDBMigrating = YES;
}
</code></pre>
<p>由于 JMessage SDK 会在 setup 时检测数据库升级，如果有需要就发出通知。所以建议在 AppDelegate 里调用 setupJMessage 之前就添加监听。</p>
<p>另外一个建议在 AppDelegate 里监听的通知是当前用户被踢出登录。</p>
<pre><code>- (void)onLoginUserKicked;
</code></pre>
<h4 id="_4">结果回调</h4>
<p>JMessage SDK 提供的很多接口都以异步方式返回，其回调都是一个类型为 JMSGCompletionHandler 的 block，其定义为</p>
<pre><code>    typedef void (^JMSGCompletionHandler)(id resultObject, NSError *error);
</code></pre>
<p>JMSGCompletionHandler 有 2 个参数：</p>
<ul>
<li>id resultObject 返回的结果对象</li>
<li>NSError *error 返回的错误</li>
</ul>
<p>如果 error 不为 nil，则表示调用出错，error -&gt; code 定义了错误码，error -&gt; description 有错误的详细说明。也可以从文档里根据错误码找到进一步的错误说明信息。</p>
<p>如果 error 为 nil，则调用成功，resultObject 是返回结果对象。每个接口 resultObject 的实际类型不同，在每个接口的定义文档里会指定。实际使用时，应把该 resultObject 转型为该接口的正常对象。</p>
<p>与 JMSGCompletionHandler 类似的，还有另外一个 block 叫 JMSGAsyncDataHandler，用于返回媒体文件数据。</p>
<h4 id="jmsguserh">注册与登录、用户信息 JMSGUser.h</h4>
<pre><code>
// 新用户注册
+ (void)registerWithUsername:password:completionHandler:

// 用户登录
+ (void)loginWithUsername:password:completionHandler:

// 当前用户退出登录
+ (void)logout:

// 获取我的信息（当前登录用户）
+ (JMSGUser *)myInfo

// 获取用户详情（批量接口）
+ (void)userInfoArrayWithUsernameArray:completionHandler:

// 更新我的信息（当前登录用户）
// 只支持每次更新一个 UserInfo 字符。需要根据 type 去定义要更新的字段类型。
+ (void)updateMyInfoWithParameter:userFieldType:completionHandler:

// 更新密码（当前登录用户）
+ (void)updateMyPasswordWithNewPassword:oldPassword:completionHandler:

// 获取头像缩略图
- (void)thumbAvatarData:

// 获取头像大图
- (void)largeAvatarData:

// 展示名
- (NSString *)displayName

</code></pre>

<h4 id="jmsgconversationh">会话 JMSGConversation.h</h4>
<pre><code>
// 获取单聊会话
+ (JMSGConversation *)singleConversationWithUsername:

// 获取群聊会话
+ (JMSGConversation *)groupConversationWithGroupId:

// 创建单聊会话
+ (vodi)createSingleConversationWithUsername:completionHandler:

// 创建群聊会话
+ (void)createGroupConversationWithGroupId:completionHandler:

// 删除单聊会话
+ (BOOL)deleteSingleConversationWithUsername:

// 删除群聊会话
+ (BOOL)deleteGroupConversationWithGroupId:

// 获取全部会话列表
// 暂未提供分页方式。性能上考虑了优化，应该不会有问题
+ (void)allConversations:

// 获取单条消息
- (JMSGMessage *)messageWithMessageId:

// 获取多条消息（同步接口）
// 建议使用这个接口时，每次取出的条数（limit）不要太大，否则可能存在性能问题

- (NSArray)messageArrayFromNewestWithOffset:limit:

// 获取全部消息（异步接口）
// 一次性取出来一个会话里全部消息。如果预计消息条数不是太多，可以使用此接口。使用上相对简单。
- (void)allMessages:

// 删除单条消息
- (BOOL)deleteMessageWithMessageId:(NSString *)msgId

// 删除全部消息
- (BOOL)deleteAllMessages:

// 创建消息对象
// 需要先创建消息内容（content）。这是同步接口，创建媒体消息尤其是图片时可能会卡。
- (JMSGMessage *)createMessageWithContent:

// 创建消息对象
// 异步接口，专用于创建图片消息，因为创建消息时 SDK 要保存到文件，并且要做缩略图，有一定的性能损耗
- (void)createMessageAsyncWithImageContent:completionHandler:

// 发送消息。基于创建好的消息对象
- (void)sendMessage:

// 发送文本消息。不需要预先创建好消息对象。
- (vodi)sendTextMessage:

// 发送图片消息。不需要预先创建好消息对象。
- (void)sendImageMessage:

// 发送语音消息。不需要预先创建好消息对象。
- (void)sendVoiceMessage:duration:

// 获取会话头像
- (void)avatarData:

// 清除会话未读数
- (vodi)clearUnreadCount

// 获取最后一条消息的文本描述。一般用于显示在会话列表上
- (NSString *)latestMessageContentText

// 判断某条消息是否属于当前会话
- (BOOL)isMessageForThisConversation:

// 刷新会话对象的信息（从服务器）
- (void)refreshTargetInfoFromServer:

</code></pre>

<h4 id="jmsgmessageh">消息 JMSGMessage.h</h4>
<pre><code>
// 创建单聊消息
+ (JMSGMessage *)createSingleMessageWithContent:username:

// 创建群聊消息
+ (JMSGMessage *)createGroupMessageWithContent:groupId:

// 发送消息。发送创建好的消息对象
+ (void)sendMessage:

// 发送单聊文本消息
// 如果最简单地使用 SDK 的发消息功能，这是最快捷的方式：不必先获取会话，不必先创建 JMSGMessage 对象
+ (void)sendSingleTextMessage:toUser:

// 发送单聊图片消息
+ (void)sendSingleImageMessage:toUser:

// 发送单聊语音消息
+ (void)sendSingleVoiceMessage:voiceDuration:toUser:

// 发送群聊文本消息
+ (void)sendGroupTextMessage:toGroup:

// 发送群聊图片消息
+ (void)sendGroupImageMessage:toGroup:

// 发送群聊语音消息
+ (void)sendGroupVoiceMessage:voiceDuration:toGroup:

// 设置消息的来源用户
- (void)setFromName:

// 更新消息标志
- (void)updateFlag:

// 获取消息的 JSON 字符串
- (NSString *)toJsonString
- 
</code></pre>

<h4 id="jmsggrouph">群组 JMSGGroup.h</h4>
<pre><code>
// 创建群组
+ (void)createGroupWIthName:desc:memberArray:completionHandler:

// 更新群组信息
+ (void)updateGroupInfoWIthGroupId:name:desc:completionhandler:

// 获取群组详情（不包含群组成员）
+ (void)groupInfoWithGroupId:completionHandler:

// 获取我的群组列表
+ (vodi)myGroupArray:

// 获取当前群组成员列表
- (NSArray *)memberArray

// 添加群组成员
- (void)addMembersWithUsernameArray:completionHandler:

// 删除群组成员
- (void)removeMembersWithUsernameArray:completionHandler:

// 退出群组（当前用户）
- (void)exit:

// 获取展示名称
- (NSString *)displayName 
</code></pre>

<h3 id="_5">实现回调</h3>
<h4 id="conversation">Conversation 回调</h4>
<pre><code>// optional
// 收到此通知后, 建议处理: 如果 App 当前在会话列表页，刷新整个列表；如果在聊天界面，刷新聊天标题。
- (void)onConversationChanged:(JMSGConversation *)conversation;

// optional
// 未读消息数变更
- (void)onUnreadChanged:(NSUInteger)newCount;
</code></pre>

<h4 id="group">Group 回调</h4>
<pre><code>// optional
// 群信息详情被改变
- (void)onGroupInfoChanged:(JMSGGroup *)group;
</code></pre>

<h4 id="user">User 回调</h4>
<pre><code>// optional
// 用户在其他设备上登录，当前设备被踢出登录。
- (void)onLoginUserKicked;
</code></pre>

<h4 id="database-migrate">Database Migrate 回调</h4>
<pre><code>// optional
// 数据库开始升级
 (void)onDBMigrateStart;

// optional
// 数据库升级结束，如果 Error 为 nil 代表升级成功，否则为失败
- (void)onDBMigrateFinishedWithError:(NSError *)error;
</code></pre>

<h3 id="_6">针对跨应用的变更</h3>
<ul>
<li>Converstaion</li>
</ul>
<pre><code>// 获取跨应用单聊会话
+ (JMSGConversation * JMSG_NULLABLE)singleConversationWithUsername:(NSString *)username
                                                            appKey:(NSString *)userAppKey;

// 创建跨应用单聊会话
+ (void)createSingleConversationWithUsername:(NSString *)username
                                      appKey:(NSString *)userAppKey
                           completionHandler:(JMSGCompletionHandler JMSG_NULLABLE)handler;

// 删除跨应用单聊会话
+ (BOOL)deleteSingleConversationWithUsername:(NSString *)username
                                      appKey:(NSString *)userAppKey;

// 会话目标用户所在的 appKey
@property(nonatomic, strong, readonly) NSString *targetAppKey;

</code></pre>

<ul>
<li>Message</li>
</ul>
<pre><code>// 消息发送目标应用
@property(nonatomic, strong, readonly) NSString *targetAppKey;

// 消息来源用户 Appkey
@property(nonatomic, strong, readonly) NSString *fromAppKey;

</code></pre>

<ul>
<li>User</li>
</ul>
<pre><code>// 批量获取跨应用的用户信息
+ (void)userInfoArrayWithUsernameArray:(NSArray JMSG_GENERIC(__kindof NSString *)*)usernameArray
                                appKey:( NSString *JMSG_NULLABLE)userAppKey
                     completionHandler:(JMSGCompletionHandler)handler;


// 此用户所在的 appKey
@property(nonatomic, copy, readonly) NSString * JMSG_NULLABLE appKey;
</code></pre>

<h3 id="example">Example 代码样例</h3>
<p>更多样例请参考 JChat 开放源代码项目。</p>
<h4 id="_7">单聊发文本消息</h4>
<pre><code>NSString *text = @&quot;Hello, JMessage&quot;;
NSString *username = @&quot;alice&quot;;

// 最简单的方式
[JMSGMessage sendSingleTextMessage:text];

// 要为消息内容附加字段
JMSGTextContent *textContent = [[JMSGTextContent alloc] initWIthText:text];
[textConent addStringExtra:@&quot;extraValue&quot; forKey:@&quot;extraKey&quot;];

// 不关注会话的情况
JMSGMessage *message = [JMSGMessage createSingleMessageWithContent:textContent username:username];
[JMSGMessage sendMessage:message];

// 要处理会话的情况
JMSGConversation *conv = [JMSGConversation createSingleConversationWithUsername:username];
JMSGMessage *message2 = [conv createMessageWithContent:textContent];
[conv sendMessage:message2];

</code></pre>

<h3 id="see-also">See Also 相关文档</h3>
<ul>
<li><a href="../../../guideline/jmessage_guide/">极光IM 指南</a></li>
<li><a href="../../../guideline/jmessage_ios_guide/">JMessage iOS 集成指南</a></li>
<li><a href="../../../advanced/im_message_protocol/">IM 消息协议</a></li>
<li><a href="../../../client/im_sdk_android/">IM SDK for Android</a></li>
<li><a href="../../../server/rest_api_im/">IM REST API</a></li>
</ul> </div>
                        </div> <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../im_errorcode/" class="btn btn-neutral float-right" title="IM ErrorCode 定义">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../im_sdk_android/" class="btn btn-neutral float-left" title="IM Android SDK 概述"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright 2011-2016, jiguang.cn, All Rights Reserved. <br />粤ICP备12056275号-5 深圳市和讯华谷信息技术有限公司</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer> </div>
                </section>
            </div>
            <div class="col-lg-1">
                <div class="visible-lg">
                    <div id="tocright">
                        <div id="navbar-right">
                            <div>
                                <p>目录</p>
                            </div>
                            
	<ul class="nav" >
    
        
            <li><a href="#summary">Summary 概述</a></li>
        
            <li><a href="#functions">Functions 功能</a></li>
        
            <li><a href="#api">API 接口</a></li>
        
            <li><a href="#_5">实现回调</a></li>
        
            <li><a href="#_6">针对跨应用的变更</a></li>
        
            <li><a href="#example">Example 代码样例</a></li>
        
            <li><a href="#see-also">See Also 相关文档</a></li>
        
    
    </ul>
    


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</body>

</html>